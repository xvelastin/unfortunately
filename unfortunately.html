<!DOCTYPE html>
<html lang="en">

<!-- *** Version 2.2 (Dec 2021): Standalone Web *** -->

<head>
    <!-- Primary Meta Tags -->
    <title>unfortunately, unfortunately</title>
    <meta name="title" content="unfortunately, unfortunately">
    <meta name="description" content="A little poem made from rejection emails from arts organisations.">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="http://xaviervelastin.com/interactive/unfortunately/unfortunately.html">
    <meta property="og:title" content="unfortunately, unfortunately">
    <meta property="og:description" content="A little poem made from rejection emails from arts organisations.">
    <meta property="og:image" content="http://xaviervelastin.com/interactive/unfortunately/screengrab1.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="http://xaviervelastin.com/interactive/unfortunately/unfortunately.html">
    <meta property="twitter:title" content="unfortunately, unfortunately">
    <meta property="twitter:description" content="A little poem made from rejection emails from arts organisations.">
    <meta property="twitter:image" content="http://xaviervelastin.com/interactive/unfortunately/screengrab1.png"> 
        
    <link rel="icon" href="https://xaviervelastin.com/interactive/unfortunately/favicon.ico" />
    <link rel="stylesheet" href="stylesheet.css" />
        
</head>
<body>

    <div id="audiocontainer">
        <div id="marimb"></div>
    </div>


    <div id="header">
        <h2><a class="btn" href="https://xaviervelastin.com">unfortunately unfortunately - xaviervelastin</a></h2>
    </div>

    <div id="mainBlock">
        <div id="splash" style="display:none">
            <h1 id="title" onclick="hideanddestroy(this, 1);  hidecursor(); init();">start</h1>
        </div>

        <div id="intro" class="col centred">
            <div id="textNode"></div>
        </div>
    </div>

    <div id="footer">
        <h2></h2>
    </div>

</body>
</html>


<script id="jsMain">
    // Display options //

    let hasInit = false;
    const audioContainer = document.getElementById("audiocontainer");

    window.onload = function () {
        voiceinit(); // sets up audio channels

        //move splash randomly at start
        const splash = document.getElementById("splash");
        const posY = getRandomInt(20, 60);
        const posX = getRandomInt(20, 60);
        splash.style.top = posY + "vh";
        splash.style.left = posX + "vw";
        
        splash.style.display = 'block';
    }

    function init() {
        if (hasInit) return;
        setTimeout(function () {
            LoadStrings(0);
            hasInit = true;
        }, 1000)
    }



    function hidecursor() {
        const mainblock = document.getElementById('mainBlock');
        mainblock.style.cursor = 'none';
    }

    function ChangeOpacity(el_id, time, targetOpacity) {
        let el = document.getElementById(el_id);
        el.style.transition = "opacity " + time + "s";
        el.style.opacity = targetOpacity;
    }

    function hideanddestroy(el, t) {
        el.style.transition = "opacity " + t + "s";
        el.style.opacity = '0';
        setTimeout(function () {
            el.style.display = 'none';
        }, t * 1000)

    }

    function hide(el, t) {
        el.style.transition = "opacity " + t + "s";
        el.style.opacity = '0';

    }

    function unhide(el, t) {
        el.style.transition = "opacity " + t + "s";
        el.style.opacity = '1';

    }

</script>

<script id="jsStrings">
// JavaScript source code

const numStrings = 1000;
let numHits = 0;
let numHitsThresh = 15;
let textBlockSection = 0;

function ScrambleText(stringArray, creationNode) {
    // re-orders array, places on screen and attaches visual/audio triggers

    let arraylength = stringArray.length - 1;
    let index = getRandomInt(0, arraylength);

    let newSpan = document.createElement("span");
    newSpan.className = "hidden introWords";
    newSpan.innerHTML = stringArray[index] + " ";
    newSpan.style.color = "rgb(" + getRandomInt(100, 255) + ", " + getRandomInt(100, 255) + ", " + getRandomInt(100, 255) + ")";

    // Makes into audio trigger and assigns sound
    MakeAudioTrigger(newSpan, 'marimb', 15, 0.01);

    // Changes css classes on mouse events and trigger numhit counter
    newSpan.addEventListener("mouseenter", function () {
        newSpan.className = "hidden-hover introWords";
        TriggerNumHit();
    });

    newSpan.addEventListener("click", function () {
        let index = getRandomInt(0, arraylength);
        newSpan.innerHTML = stringArray[index] + " ";
        TriggerNumHit();
    });

    newSpan.addEventListener("mouseout", function () {
        newSpan.className = "hidden-remains introWords";
    });

    creationNode.appendChild(newSpan);
}


function TriggerNumHit() {
    // Adds and logs to the counter to track which text blcok we're currently in.
    if (numHits >= numHitsThresh-1) {
        textBlockSection = (textBlockSection + 1) % textblocks.length;
        LoadStrings(textBlockSection); 

        numHitsThresh += 5; // number of numHits needed to go to next para increases each time it moves on
        numHits = 0;
    }
    numHits++;
}

function MakeAudioTrigger(el, audioclip, numsamps, startingVol) {
    // Makes a given element trigger audio on mouse events.
    el.addEventListener("mouseenter", function () {
        PlayAudioClip(audioclip, numsamps, startingVol);
    });

    el.addEventListener("click", function () {
        PlayAudioClip(audioclip, numsamps, startingVol);
    });
}

function LoadStrings(section) {
    // Populates the text area with the individual phrases/words as marked with forward slashes
    let textNode = document.getElementById('textNode');
    textNode.remove();
    textNode = document.createElement('div');

    textNode.id = 'textNode';
    const introNode = document.getElementById('intro');
    introNode.appendChild(textNode);

    // puts new text in
    let strings = textblocks[section].split('/');

    for (var i = 0; i < numStrings; ++i) {
        ScrambleText(strings, textNode);
    }

}

// Text blocks
const textblocks = [
    /* Part 1: thank you (so many great applications!) */
    // hello
    "hi xavier / hi xavier, / dear xavier / hi xavier! / dear xavier, / dear applicant, / dear xavier, / dear xavier, / dear xavier, / hello, / hello xavier, / hello xavier / hello, / hi,",
    // thanks
    "thanks a lot / thanks so much / thank you / thank you /  thank you / very much / many thanks /  thank you again / thank you / very much / thank you / many thanks /  so much /",
    // for your time
    "for the / for your / and your  / for your / for our / for your / for applying to / for your recent application to / for this position / for your recent proposal /  for applying /  for your application / for taking the time / for your time / for sharing your work with us / the time / for your / recent application to / for taking the time /",
    // for our role
    "sound designer / role / application / patience! / recent proposal / radio arts / catalyst / residency / opportunity / application / create artwork / the lowry's / live now / commission programme / to hcmf shorts / immersive audio  / r&d / open call / barbican theatre / open lab / jerwood arts / live work fund / covid-19 commission / open call / to be part of / unshut 2020 / the 1927 bursary / residency / the bac-rcssd / aural-oral dramaturgies project / the reach showcase / loud & queer festival /",
    // so hard
    "it took a long time / to get / through everything, / since / it has taken longer than / some difficult / decisions / had to be made / some / difficult decisions / had to be made. / a difficult process / rather hard, / selecting just one /  much more difficult / than anticipated / highly competitive /extremely tough / humbling / very hard /" ,
    // so many
    "a wealth of / a huge number of / a high number of / the volume and quality / a lot of applications / a very high standard / highest ever / number of applications / very high standard so / excellent standard. / over 25 proposals / huge number /  large number / unprecedented / unprecedented number / 1283 in total / over 200 / over 100 / over 400 / just 6 / 82 / the amount of people / truly unprecedented /" ,
    // everyone was amazing
    "a lot of great music. /  high quality applications / very high / great piece of work. / have been incredibly high /  standard of the proposals / astounded / really impressed  / incredibly high standard / blown away / overjoyed and overwhelmed /",

    /* Part 2: unfortunately, unfortunately */
    // sorry
    " unfortunately / on this occasion / we regret to inform you / unfortunately / after careful consideration / i'm sorry / we have decided / on this occasion / unfortunately / decided not to / this time / unfortunately / we decided / unfortunately / unfortunately / i'm afraid to say / unfortunately / on this occasion / i'm sorry to say /  this year /",
    // but no
    "not successful / haven't been selected / unsuccessful / not be taking it further / has been unsuccessful / have not / been selected / on this occasion / not to award / the bursary / take your / application further / did not make / the final selection / another candidate  / the next stage / we won't / be able to / invite you to / chat with natalie further / not successful / has been unsuccessful /",
    // no, no feedback
    "we do not / we are unable to / we are unable to / we are not / offering / offer / provide / individual feedback /  personal feedback / meaningful feedback / any feedback / on the applications / more detailed feedback / detailed feedback /",
    // we just can't
    "unfortunately / due to the amount of applications / very large number / many good ones / limited number of slots / weren't responsible / very hard / limited resources / however / level of competition / extremely strong / capacity constraints / volume of submissions / staffing resource /",
    // try again later
    "we hope / you manage / another project / thank you so much / we understand / hugely frustrating / we thank you / please / down-heartened / know how important feedback is / however / disappointing! / we appreciated / the thought and effort /  we hope / a little insight / all the best / future endeavors / please / re-apply / in the future / we would love to keep your details on file / future events and festivals /",

    /* Part 3: disclaimer */
    // this is private
    "confidential information / this email / and / any files / are confidential /contain privileged /  copyright information / the information / contained / in it / with it / notify us / disclaimer / disclaimer / this email / this message / transmitted /    than to / e-mail / e-mail / by mistake / this e-mail / solely for / the addressee / strictly confidential / legally privileged / or any attachments / freedom of information / fascimile / ",
    // you must not use
    "if / you are not / for any purpose / you must not copy, distribute or use / you must not present  / this / from / the sender. / the intended / recipient  / other / message / to / another party / without / gaining permission / delete this / e-mail / from / your system / if / you are not / the addressee / do not print / re-transmit / store / act in reliance / e-mail back / immediately and / permanently delete / it / strictly prohibited / otherwise / nor make use of its contents / you may not / unless /",
    
]
</script>


<script id="jsAudio">
    /* Audio Scripts */

    const maxVoices = 32;
    const dirSamples = "audio/"
    let currentVoice = 0;
    let voices = [];
    let isMuted = false;

    function voiceinit() {
        // Initialises channels (voices) based on max voices number - avoids making thousands of channels.

        for (var i = 0; i < maxVoices; ++i) {
            let newVoice = new Audio();
            audioContainer.appendChild(newVoice);
            newVoice.id = 'audio_channel-' + i;
            newVoice.className = 'audio_channel';
            voices.push(newVoice);
        }    
    }

    function PlayAudioClip(base_filename, numberofsamples, startingVolume) {
        let i = getRandomInt(1, numberofsamples);
        let clipFileName = dirSamples + base_filename + "_" + i + ".mp3";

        let selectedVoice = voices[currentVoice];      // assigns the next open voice to the selected clip
        selectedVoice.src = clipFileName;
        selectedVoice.id = 'audio.' + clipFileName;
        selectedVoice.volume = startingVolume;
        selectedVoice.play();

        currentVoice = (currentVoice + 1) % maxVoices;      // continues the count %maxvoices   
    }

    function ChooseAndStartAudio(basename, numberofsamples, startingVolume) {
        // Choose an audio clip from a sample bank with the syntax [samplename] + "_" + [sample#] + .mp3.
        PlayAudioClip(clipFileName, startingVolume);
    }


    function MakeAudioTrigger(el, audioclip, numsamps, startingVol) {
        el.addEventListener("mouseenter", function () {
            PlayAudioClip(audioclip, numsamps, startingVol);
            if (textBlockSection > 8) PlayAudioClip(audioclip, numsamps, startingVol);
            if (textBlockSection > 13) PlayAudioClip(audioclip, numsamps, startingVol);
        });

        el.addEventListener("click", function () {
            PlayAudioClip(audioclip, numsamps, startingVol);
        });
    }

    function FadeAudio(audioID, targetVol, duration) {
        /* For some reason, I made a fade function myself */
        
        clearInterval(TriggerSegmentFader);
        clearTimeout(StopSegmentFader);        

        audioID = 'audio.' + audioID;                           // passes by ID so it can be put through via buttons etc
        let audioToFade = document.getElementById(audioID);

        const grain = 10;                                       // resolution of fade (saves processing when > 1)
        duration = duration * 1000;                             // to ms

        let startingVol = audioToFade.volume;
        let distanceToFade = targetVol - startingVol;
        let volsegment = distanceToFade / (duration / grain);   // splits fade into segments, for setInterval to proceed with per every [grain] ms.

        //if (startingVol == targetVol) return;

        console.log("FadeAudio triggered on " + audioID + ". Fading from " + startingVol + " to " + targetVol + " over " + duration / 1000 + " seconds.");

        // Start Fade Process //

        var fadeVol = 0; // relative volume from start of fade to end of fade
        var newTotalVol; // final volume adjusted for minimum

        var TriggerSegmentFader = setInterval(function () {
            segmentFader();
        }, grain);

        var StopSegmentFader = setTimeout(function () {
            clearInterval(TriggerSegmentFader);
        }, duration);


        function segmentFader() {
            fadeVol += volsegment;
            newTotalVol = Math.min(Math.max(0, fadeVol + startingVol), 1);
            audioToFade.volume = newTotalVol;
        }
    }

    function MuteAudioOutput() {
        isMuted = !isMuted;

        let newVol = isMuted ? 0 : 1;
        console.log('ismuted = ' + isMuted + ' || newVol = ' + newVol);

        for (var i = 0; i < voices.length; ++i) {
            FadeAudio(voices[i].id, newVol, 0.1);
        }

        let newAudioObjects = document.getElementsByClassName('new_audio_channel');
        for (var i = 0; i < newAudioObjects.length; ++i) {
            FadeAudio(newAudioObjects[i].id, newVol, 0.1);
        }
    }





</script>


<script id="jsGlobalFuncs">
    /* commonly called functions */

    function getRandomInt(min, max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function ConvertAtoDb(amp) {
        var db;
        if (amp > ConvertDbtoA(-70)) {
            db = 20 * Math.log(amp) / Math.log(10);
        }
        else db = -70;
        return db;
    }

    function ConvertDbtoA(db) {
        let amp = Math.pow(10, db / 20);
        return amp;
    }
</script>